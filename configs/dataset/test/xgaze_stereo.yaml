test_dataset:
  type: StereoGazeDataset
  img_per_frame: ${img_per_frame}
  cam_pairs: ${cam_pairs.train}
  indices: &base_index
    type: XGazeIndex
    # root: ${path.xgaze.test_root}
    root: ${path.xgaze.train_root}
    # subject_keys: ${xgaze_subject.test}
    subject_keys: ${if:${is_cross_eval}, null, ${xgaze_subject.test}}
    cam_indices: ${camera.val}
  preprocess:
    type: ComposePreprocess
    preprocesses:
      - type: FixSeed
        seed_shift: 1 # val=0, test=1
      - type: UnpackHdf
      - type: AppendXGazeCalib
        path_pattern: ${path.xgaze.calibration}
      - type: Rename
        name_map:
          Distortion_Coefficients: cam_distorion
          Camera_Matrix: cam_mat
          cam_translation: t
          cam_rotation: rot
          face_patch: img
          face_gaze: gt_gaze
      - type: BGR2RGB
        img_key: img
      - type: PixelTransform
        img_key: img
        transforms:
          - type: ToPILImage
          - type: ToTensor
          - type: Normalize
            mean: [0.485, 0.456, 0.406]
            std: [0.229, 0.224, 0.225]
      - type: UnnormalizeRot
      - type: DeepCopy
        src_key: rot
        dst_key: calib_rot
      - type: ${if:${use_calib.eval}, DoNothing, CalibFromHeadpose}
      - type: NumpyToTensor
  stereo_preprocess:
    type: ComposePreprocess
    preprocesses:
      - type: RenameRef
test_loader:
  type: DataLoader
  dataset: ${test_dataset}
  generator:
    type: Generator
  batch_size: ${batch_size}
  shuffle: false
  num_workers: ${num_workers}
  drop_last: false
  pin_memory: true

